generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  ADMIN
  USER
}

enum Status {
  ACTIVE
  TERMINATED
  SUSPENDED
}

enum Interest {
  WEB_DEVELOPMENT
  MOBILE_DEVELOPMENT
  BACKEND_DEVELOPMENT
  FRONTEND_DEVELOPMENT
  FULLSTACK_DEVELOPMENT
  GAME_DEVELOPMENT
  DESKTOP_DEVELOPMENT

  JAVASCRIPT
  PYTHON
  JAVA
  TYPESCRIPT
  CSHARP
  GO
  RUST
  PHP

  REACT
  ANGULAR
  VUE
  NODEJS
  DJANGO
  SPRING
  DOTNET
  FLUTTER
  REACT_NATIVE

  DATA_SCIENCE
  MACHINE_LEARNING
  ARTIFICIAL_INTELLIGENCE
  BIG_DATA
  DATA_ANALYTICS

  CLOUD_COMPUTING
  DEVOPS
  DOCKER
  KUBERNETES
  AWS
  AZURE
  MICROSERVICES

  SQL_DATABASES
  NOSQL_DATABASES
  DATABASE_DESIGN

  CYBERSECURITY
  ETHICAL_HACKING
  WEB_SECURITY

  UI_UX_DESIGN
  WEB_DESIGN
  PRODUCT_DESIGN

  BLOCKCHAIN
  CRYPTOCURRENCY
  WEB3
  IOT
  AR_VR
  QUANTUM_COMPUTING

  SOFTWARE_ARCHITECTURE
  API_DEVELOPMENT
  TESTING
  AGILE_METHODOLOGIES

  LINUX
  OPEN_SOURCE
  GIT_VERSION_CONTROL
  NETWORKING
}

enum AuthProvider {
  LOCAL
  GOOGLE
  GITHUB
}

model User {
  id       String  @id @default(uuid())
  username String  @unique @db.VarChar(20)
  email    String  @unique @db.VarChar(345)
  password String? @db.VarChar(60)

  profilePictureUrl String?
  profilePictureKey String?

  bio              String?       @db.VarChar(150)
  interests        Interest[]
  reputationPoints Int           @default(0)
  role             Role          @default(USER)
  questionsAsked   Int           @default(0)
  answersGiven     Int           @default(0)
  acceptedAnswers  Int           @default(0)
  bestAnswers      Int           @default(0)
  achievements     Achievement[]
  status           Status        @default(ACTIVE)

  moderationStrikes ModerationStrike[]
  warnings          Warning[]
  bans              Ban[]

  moderationStats ModerationStats?

  otp                               String?
  otpResendAvailableAt              DateTime?
  otpExpireAt                       DateTime?
  resetPasswordOtp                  String?
  resetPasswordOtpVerified          Boolean?
  resetPasswordOtpResendAvailableAt DateTime?
  resetPasswordOtpExpireAt          DateTime?
  isVerified                        Boolean      @default(false)
  authProvider                      AuthProvider @default(LOCAL)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ModerationStats {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique

  totalStrikes  Int @default(0)
  rejectedCount Int @default(0)
  flaggedCount  Int @default(0)

  lastStrikeAt DateTime?
  trustScore   Float     @default(1.0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Achievement {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String

  name        String @db.VarChar(15)
  description String @db.VarChar(100)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ContentType {
  QUESTION
  ANSWER
  REPLY
}

enum Mods {
  ADMIN_MODERATION
  AI_MODERATION
}

enum AiDecision {
  BAN_TEMP
  BAN_PERM
  WARN
  IGNORE
}

enum BanType {
  PERM
  TEMP
}

model ModerationStrike {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String

  aiDecision   AiDecision?
  aiConfidence Float?
  aiReasons    String[]
  severity     Int?
  riskScore    Float

  targetContentId      String
  targetType           ContentType
  targetContentVersion Int?

  strikedBy Mods

  expiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Warning {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String

  title    String   @db.VarChar(30)
  reasons  String[]
  severity Int
  warnedBy Mods

  seen      Boolean @default(false)
  delivered Boolean @default(false)

  expiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Ban {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String

  title    String   @db.VarChar(30)
  reasons  String[]
  banType  BanType
  severity Int
  bannedBy Mods

  expiresAt  DateTime?
  durationMs Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
